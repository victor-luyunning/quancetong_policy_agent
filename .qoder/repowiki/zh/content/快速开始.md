# 快速开始

<cite>
**本文档引用的文件**  
- [requirements.txt](file://requirements.txt)
- [start.bat](file://start.bat)
- [start_new.sh](file://start_new.sh)
- [stop_new.sh](file://stop_new.sh)
- [app.py](file://app.py)
- [test_query.py](file://test_query.py)
- [快速开始.md](file://快速开始.md)
- [.env](file://.env)
</cite>

## 目录
1. [简介](#简介)
2. [环境准备](#环境准备)
3. [配置大模型API密钥](#配置大模型api密钥)
4. [启动服务](#启动服务)
5. [调用API进行测试](#调用api进行测试)
6. [停止服务](#停止服务)
7. [常见问题](#常见问题)

## 简介

泉策通是一款智能政策咨询服务系统，能够帮助用户快速查询家电、数码、汽车、零售餐饮等领域的补贴政策，并计算个人可享受的福利金额。本指南将指导您在10分钟内完成本地环境搭建并成功调用API获取响应。

**核心功能**：
- 政策智能解析
- 个人福利计算
- 区域政策对比
- 企业投资信号分析

**服务地址**：`http://127.0.0.1:8000`  
**API文档**：`http://127.0.0.1:8000/docs`  
**健康检查**：`http://127.0.0.1:8000/health`

**Section sources**
- [app.py](file://app.py#L1-L155)
- [快速开始.md](file://快速开始.md#L1-L149)

## 环境准备

### Python版本要求
- 推荐使用 **Python 3.8 - 3.11**
- 请确保已安装 `pip` 包管理工具

### 安装依赖
打开终端或命令提示符，执行以下命令安装所需依赖：

```bash
pip install fastapi uvicorn python-dotenv httpx pydantic requests
```

或者使用项目提供的依赖文件：

```bash
pip install -r requirements.txt
```

**预期输出**：
```
Successfully installed fastapi-0.104.0 uvicorn-0.24.0 python-dotenv-1.0.0 ...
```

**Section sources**
- [requirements.txt](file://requirements.txt#L1-L7)

## 配置大模型API密钥

### 创建 .env 文件
在项目根目录下创建名为 `.env` 的文件，内容如下：

```env
DASHSCOPE_API_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
DASHSCOPE_API_KEY=your_api_key_here
```

### 获取API密钥
1. 访问 [阿里云百炼平台](https://console.aliyun.com/dashscope)
2. 登录后进入"API密钥管理"页面
3. 创建新的API密钥并复制到 `.env` 文件中

> **注意**：请将 `your_api_key_here` 替换为您实际的API密钥

**Section sources**
- [intent_parser.py](file://workflows/intent_parser.py#L11-L12)
- [llm_writer.py](file://workflows/llm_writer.py#L10-L11)

## 启动服务

### Windows系统
双击运行 `start.bat` 文件，或在命令行中执行：

```cmd
start.bat
```

### Linux/Mac系统
赋予脚本执行权限后运行：

```bash
chmod +x start_new.sh
./start_new.sh
```

### 预期输出
```
======================================
启动泉策通智能体服务 v2.0
======================================
检查依赖...
启动服务（端口 8000）...

✅ 服务启动成功！
   访问地址: http://127.0.0.1:8000
   健康检查: http://127.0.0.1:8000/health
   查询接口: POST http://127.0.0.1:8000/query

查看日志: tail -f logs/app.log
停止服务: ./stop_new.sh
======================================
```

**Section sources**
- [start.bat](file://start.bat#L1-L39)
- [start_new.sh](file://start_new.sh#L1-L35)

## 调用API进行测试

### 使用 curl 命令测试
打开新终端窗口，执行以下命令：

```bash
curl -X POST http://127.0.0.1:8000/query \
  -H "Content-Type: application/json" \
  -d '{"query": "在济南买了3000元的空调，能领多少补贴？"}'
```

### 使用 Python 脚本测试
```bash
python test_query.py "在济南买了3000元的空调，能领多少补贴？"
```

### 预期响应结果
```json
{
  "success": true,
  "intent": "personal_welfare",
  "raw_text": "在济南买了3000元的空调，能领多少补贴？",
  "entities": {
    "location": "济南",
    "product": "空调",
    "industry": "appliance",
    "price_paid": 3000
  },
  "result": {
    "subsidy_amount": 600,
    "subsidy_breakdown": "基础补贴15%: 450元; 以旧换新5%: 150元",
    "total_benefit": 600
  },
  "final_answer": "您在济南购买3000元的空调，可享受600元补贴...",
  "citations": "参考来源：济南市2025年家电以旧换新补贴活动公告"
}
```

**Section sources**
- [app.py](file://app.py#L37-L110)
- [test_query.py](file://test_query.py#L1-L80)

## 停止服务

### Windows系统
- 直接关闭运行 `start.bat` 的命令行窗口
- 或按 `Ctrl+C` 组合键终止进程

### Linux/Mac系统
运行停止脚本：

```bash
./stop_new.sh
```

### 预期输出
```
======================================
停止泉策通智能体服务
======================================
停止服务 (PID: 12345)...
✅ 服务已停止
======================================
```

**Section sources**
- [stop_new.sh](file://stop_new.sh#L1-L36)

## 常见问题

### Q1: 服务无法启动？
**A**: 检查端口8000是否被占用
```bash
# Windows
netstat -ano | findstr :8000

# Linux/Mac
lsof -i :8000
```

### Q2: 提示API Key错误？
**A**: 检查 `.env` 文件中的 `DASHSCOPE_API_KEY` 是否正确配置

### Q3: 中文显示乱码？
**A**: 确保所有文件使用UTF-8编码保存

### Q4: 查询结果为空？
**A**: 检查 `data/policies/policies.jsonl` 文件是否存在且不为空

### Q5: 如何查看详细日志？
**A**: 查看 `logs/app.log` 文件
```bash
# Linux/Mac
tail -f logs/app.log

# Windows
type logs\app.log
```

**Section sources**
- [快速开始.md](file://快速开始.md#L121-L137)