# MCP 工具调用指南（QuickChart / Amap-Maps / Fetch / Context7-MCP）

本文面向泉策通多工作流智能体，给出四个MCP工具的用途、常用参数、请求/响应示例，以及在各端口（8001-8008）的接入建议。配置文件为`mcp_servers.json`，已包含这四个服务地址。

通用调用约定
- 路由与参数：所有节点统一`POST /infer`；输入/输出为扁平并列字段；结构化内容以`*_json`字符串返回；多值引用用`|`分隔。
- 超时与重试：HTTP超时建议15–30s；失败重试1–2次（指数退避）。
- 安全：不在日志或响应中泄露任何密钥；只传公开URL；所有对外文本输出携带引用`kb_citations`。

——
## 1) QuickChart（图表生成）
用途
- 生成柱状/折线/饼/雷达/双轴/桑基/液体仪表等图表；返回图像URL或Base64。

典型入参字段（统一扁平）
- `chart_type`：如`column`、`bar`、`line`、`pie`、`radar`、`dual_axes`、`sankey`、`liquid`
- `data_json`：图表数据（JSON字符串，格式因图表而异）
- `width`、`height`：尺寸（可选）
- 可选：`innerRadius`（饼图设为环形）、`style_json`（主题/配色，JSON字符串）

请求/响应示例（用于8008图表服务）
- 请求
```
{
  "chart_type": "column",
  "data_json": "{\"items\":[{\"category\":\"济南\",\"value\":2000},{\"category\":\"青岛\",\"value\":1800}]}",
  "width": 800,
  "height": 400
}
```
- 响应
```
{
  "chart_url": "https://quickchart.io/…/render/abcd1234"
}
```

端口接入建议
- 8008图表服务统一封装；8004对比与8005信号灯可直接请求8008返回图。

——
## 2) Amap-Maps（中国地图/点位）
用途
- 行政区分布图（省/市/区/县）、点位地图（POI图钉/图片弹窗）、路线图。

行政区分布图（district）入参
- `name`：行政区关键字（如“山东省”、“济南市”）
- `dataType`：`number`或`enum`
- `dataLabel`：如“城市”“指数”等
- `dataValueUnit`：如“分”“亿元”（可选）
- `showAllSubdistricts`：是否显示所有下级行政区（true/false）
- `subdistricts`：可选数组，形如`[{"name":"济南市","dataValue":"省会"}]`
- `style_json`：默认填充色等（可选，JSON字符串）

点位地图（pin）入参
- `data`：POI名称关键字数组（中文，尽量具体）
- `markerPopup`：弹窗配置（`type":"image"|"simple"`、`width`、`height`、`borderRadius`）

响应
- `map_url`或`map_base64`

示例（pin，用于8005/8008）
```
{
  "data": ["济南高新区某企业园区", "济南经十路某门店"],
  "markerPopup": {"type":"image","width":60,"height":60,"borderRadius":30}
}
```

端口接入建议
- 8008统一地图封装；8005企业分布可直接请求8008返回地图URL。

——
## 3) Fetch（网页抓取）
用途
- 抓取政策原文/平台公告/新闻来源，增强RAG引用；支持原始HTML或简化文本。

入参
- `url`：目标网页
- `max_length`：最大返回字符数（默认5000）
- `raw`：是否返回原始HTML（true/false）

响应
- 简化文本：`{"text":"页面主要内容…"}`
- 原始HTML：`{"html":"<html>…</html>"}`

示例（用于8006/8002）
```
{
  "url": "https://gov.example/policy/001",
  "max_length": 5000,
  "raw": false
}
```
抓取后将引用URL加入`kb_citations`（`|`分隔）；失败返回`error_code="E_FETCH_FAIL"`并回退本地库。

——
## 4) Context7-MCP（库/产品文档检索）
用途
- 解析第三方库文档索引并分页获取特定主题内容，补充技术资料型RAG。

两步使用
- 解析库ID：传入库名称（`libraryName`），返回Context7兼容库ID（如`/vercel/next.js`）
- 获取文档：传入库ID、`topic`（如`routing`）、`page`（从1开始）

示例（用于8006）
- 解析
```
{
  "libraryName": "next.js"
}
```
- 文档
```
{
  "context7CompatibleLibraryID": "/vercel/next.js",
  "topic": "routing",
  "page": 1
}
```

——
## 在端口的整合策略
- 8001（入口意图解析）：不直接调用MCP；只产出意图与实体。
- 8002（政策解析）：必要时调用Fetch抓原文；可调用QuickChart生成说明性图。
- 8003（福利计算）：可选QuickChart展示计算结果（如额度分布）。
- 8004（区域对比）：QuickChart生成对比图；Amap生成省市分布图。
- 8005（投资信号灯）：Amap生成企业点位图；QuickChart生成雷达/排名图。
- 8006（RAG检索）：Fetch增强引用；Context7-MCP补充外部技术文档。
- 8007（LLM Writer）：不直接调用上述工具；只消费`*_json`与`kb_citations`输出文本。
- 8008（图表服务）：统一封装QuickChart/Amap，对外只暴露`chart_type|data_json|map参数`，返回`chart_url|map_url`。

——
## 错误与重试约定
- 网络错误：超时/连接失败 → 重试1–2次，降级为空结果或提示检查网络。
- 数据错误：入参缺失/格式错误 → 返回`error_code="E_INPUT_INVALID"`与校验提示。
- 渲染失败（图表/地图） → 返回`error_code="E_RENDER_FAIL"`并给出简化文本结果。

——
## 快速落地建议
- 在`8006`与`8008`节点先封装三个方法：`generate_chart`（QuickChart）、`generate_map`（Amap）、`fetch_page`（Fetch）；
- 所有对外接口严格遵循扁平参数规范：结构化均以`*_json`字符串返回，引用用`kb_citations`承载。
